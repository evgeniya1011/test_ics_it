CREATE TRIGGER  dbo.TR_Basket_insert_update ON dbo.Basket after INSERT, UPDATE
AS
BEGIN
	UPDATE b
    SET DiscountValue = CASE
                            WHEN sq.cnt >= 2 THEN b.Value * 0.05
                            ELSE 0
                        END
    FROM dbo.Basket b
    JOIN (SELECT ID_SKU, COUNT(*) AS cnt
          FROM inserted
          GROUP BY ID_SKU) sq ON b.ID_SKU = sq.ID_SKU;
END;